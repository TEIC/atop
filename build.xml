<project>

  <taskdef name="jing" classname="com.thaiopensource.relaxng.util.JingTask">
    <classpath location="Lib/jing.jar"/>
  </taskdef>
  
  <property name="inputTestOdd" value="Tests/resources/in_vitro_ODDs/transpile.odd"/>
  <basename property="oddName" file="${inputTestOdd}" suffix=".odd"/>

  <fileset id="xspec-files" dir="Tests/xspec" includes="*.xspec"/>

  <target name="test.xspec" description="Run all XSpec tests">
    <pathconvert refid="xspec-files" property="xspec.files" pathsep=" "/>
    <xslt style="Tests/xspec-runner.xslt" in="build.xml" out="Tests/xspec-runner.xml">
      <param name="files" expression="${xspec.files}"/>
    </xslt>
    <subant antfile="xspec-runner.xml" buildpath="Tests" target="xspec-runner"/>
  </target>

  <target name="transpile" description="Run the experimental transpiler">
    <xslt style="XSLT/transpile.xslt" in="${inputTestOdd}"
      out="output/${oddName}.rng">
      <classpath location="Lib/saxon-he-11.jar"/>
    </xslt>
    <jing rngfile="Schemas/relaxng.rnc" compactsyntax="true">
      <fileset file="output/${oddName}.rng"/>
    </jing>
  </target>
  
  <target name="transpileMorgana" description="Run the experimental transpiler through Morgana">
    <mkdir dir="output"/>
    <echo message="Processing ${oddName}.odd to output/${oddName}.rng"/>
    <exec executable="Lib/morgana/Morgana.sh">
      <arg value="Util/pipeline.xpl"/>
      <arg value="-option:teiOddSpecification=${inputTestOdd}"/>
      <arg value="-output:result=output/${oddName}.rng"/>
    </exec>
    <jing rngfile="Schemas/relaxng.rnc" compactsyntax="true">
      <fileset file="output/${oddName}.rng"/>
    </jing>
  </target>

</project>
