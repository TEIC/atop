<project basedir=".">
  <description>
    This is the base ant build file for the ATOP project. Eventually it will
    provide one access method for all build and test functionality. At 
    present it just has a few targets we are using in the early development
    phase of ATOP.
  </description>
  
  <!-- Globals file which defines various properties and also imports build.properties. -->
  <import file="buildGlobals.xml"/>
  
  <basename property="ploddName" file="${inputTestPlodd}" suffix=".plodd"/>

  <target name="transpile" description="Run the experimental transpiler through Morgana">
    <dirname property="ploddDir" file="${inputTestPlodd}"/>
    <echo message="Processing ${inputTestPlodd} to ${ploddDir}/${ploddName}.rng"/>
    <java failonerror="true" fork="true" classname="com.xml_project.morganaxproc3.XProcEngine" dir="${basedir}">
      <classpath>
        <pathelement location="${basedir}/Lib/morgana/MorganaXProc-IIIse.jar"/>
        <pathelement location="${basedir}/Lib/morgana/MorganaXProc-IIIse_lib/*" />
      </classpath>
      <arg value="-config=${basedir}/Lib/morgana/config.xml"/>
      <arg value="${basedir}/Util/pipeline.xpl"/>
      <arg value="-option:teiOddSpecification=${inputTestPlodd}"/>
      <arg value="-output:result=${ploddDir}/${ploddName}.rng"/>
    </java>
    <jing rngfile="${basedir}/Schemas/relaxng.rnc" compactsyntax="true">
      <fileset file="${ploddDir}/${ploddName}.rng"/>
    </jing>
    
    <!-- This should probably be done through XProc but 
         I can't figure out how to do it. -->
    <xslt style="${basedir}/XSLT/extract-schematron.xslt" 
      in="${ploddDir}/${ploddName}.rng" 
      out="${ploddDir}/${ploddName}.sch">
      <classpath location="${saxon}"/>
    </xslt>
    
  </target>
  
  <target name="test">
    <description>
      TARGET test
      This is a convenience target to run the test suite using the 
      buildTest.xml ant file.
    </description>
    <ant antfile="buildTest.xml" target="runXSpecTests"/>
    <ant antfile="buildTest.xml" target="runPloddTests"/>
  </target>


</project>
